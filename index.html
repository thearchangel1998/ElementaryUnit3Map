<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giving Directions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Nunito:wght@400;700&display=swap');

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #1a202c;
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: row;
            overflow: hidden;
        }

        /* --- SIDEBAR --- */
        #sidebar {
            width: 320px;
            background: #2d3748;
            padding: 15px;
            display: flex;
            flex-direction: column;
            border-right: 4px solid #4a5568;
            box-shadow: 5px 0 15px rgba(0,0,0,0.3);
            z-index: 100;
            overflow-y: auto;
        }

        /* --- MAIN AREA --- */
        #main-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: radial-gradient(#2d3748 1px, #1a202c 1px);
            background-size: 20px 20px;
            position: relative;
            padding: 10px;
        }

        /* --- GAME CONTAINER --- */
        #game-container {
            position: relative;
            width: 100%;
            max-width: 1600px;
            aspect-ratio: 16/9;
            background-color: #cbd5e1; /* Grey background for roads/squares like in image */
            border: 8px solid #475569;
            border-radius: 4px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            user-select: none;
        }

        /* --- BUILDINGS --- */
        .building {
            position: absolute;
            border: 1px solid #475569; /* Thin dark borders */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.9vw; 
            font-weight: 800; 
            color: #1e293b;
            line-height: 1.1;
            padding: 2px;
            z-index: 10;
            box-sizing: border-box; /* Include border in width/height */
        }
        
        .building:hover { background-color: #f1f5f9 !important; cursor: crosshair; }

        /* Colors based on image */
        .bg-beige { background-color: #fef3c7; } /* Most buildings */
        .bg-grey-build { background-color: #e2e8f0; } /* Factory/Car park */
        .bg-green-park { background-color: #bef264; } /* Parks */
        .bg-blue-pool { background-color: #93c5fd; } /* Pool */
        .bg-white-trans { background-color: white; } /* Station/Stadium bg */

        /* Specific Labels */
        .label-sm { font-size: 0.75vw; }
        .label-xs { font-size: 0.6vw; }

        /* Road Names */
        .road-label {
            position: absolute; color: #334155; font-weight: bold; font-size: 1vw;
            letter-spacing: 1px; text-transform: uppercase; pointer-events: none;
            transform: translate(-50%, -50%);
            white-space: nowrap;
            z-index: 5;
        }
        .road-v { transform: translate(-50%, -50%) rotate(-90deg); }

        /* --- PLAYERS --- */
        .player-token {
            position: absolute;
            width: 5%;
            aspect-ratio: 1/1;
            border: 3px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: top 0.05s linear, left 0.05s linear, opacity 0.3s;
            z-index: 50;
            box-shadow: 0 4px 6px rgba(0,0,0,0.4);
        }
        .player-token i { font-size: 2.5vw; color: white; }
        #player-a { background-color: #2563eb; }
        #player-b { background-color: #db2777; }
        .player-token.inactive { opacity: 0.4; filter: grayscale(1); z-index: 40; transform: scale(0.9); }

        /* --- OVERLAYS --- */
        .overlay-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 100;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            opacity: 0; pointer-events: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(8px);
        }
        #monster-screen { background: rgba(0, 0, 0, 0.9); }
        #win-screen { background: rgba(16, 185, 129, 0.9); }
        .overlay-screen.active { opacity: 1; pointer-events: all; }

        /* --- UI CSS --- */
        .team-box { flex: 1; background: #1a202c; border-radius: 8px; padding: 8px; text-align: center; border: 3px solid transparent; opacity: 0.5; transition: all 0.2s; cursor: pointer; }
        .team-box.active { opacity: 1; transform: scale(1.05); }
        .team-box.team-a.active { border-color: #3b82f6; background: #1e3a8a; }
        .team-box.team-b.active { border-color: #ec4899; background: #831843; }
        .score-btn { width: 28px; height: 28px; border-radius: 6px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .big-btn { width: 100%; padding: 12px; border-radius: 8px; font-family: 'Press Start 2P'; text-transform: uppercase; cursor: pointer; transition: all 0.1s; border-bottom: 4px solid rgba(0,0,0,0.2); font-size: 0.8rem; text-align: center; }
        .btn-confirm { background: #e53e3e; color: white; border-color: #9b2c2c; }
        .btn-confirm:hover { background: #c53030; transform: translateY(-2px); }
        .btn-confirm:active { transform: translateY(2px); border-bottom-width: 0; margin-top: 2px; }
        .btn-reset { background: #4299e1; color: white; border-color: #2b6cb0; margin-top: 8px; font-size: 0.7rem; padding: 8px;}
        
        /* Debug */
        .highlight-debug { border: 4px dashed #ef4444 !important; background: rgba(239, 68, 68, 0.4) !important; z-index: 100; }
        
        /* Blind Mode */
        .blind-mode .building { color: transparent !important; }
        .blind-mode .building i { visibility: hidden; }
        .blind-mode .road-label { opacity: 0.5; }
    </style>
</head>
<body>

    <div id="sidebar">
        <div class="text-center mb-4">
            <h1 class="text-lg font-bold text-yellow-400 font-['Press_Start_2P']">SURVIVAL MAP</h1>
            <span class="text-xs text-gray-400">Pixel Perfect Edition</span>
        </div>

        <!-- Scoreboard -->
        <div class="mb-4 bg-gray-700 p-3 rounded-lg border-l-4 border-purple-500">
            <div class="flex justify-between items-center mb-2">
                <span class="text-xs font-bold text-gray-300 uppercase">Select Team</span>
                <button onclick="resetScores()" class="text-xs text-red-400 hover:text-white underline">Reset</button>
            </div>
            <div class="flex gap-2">
                <div id="box-a" class="team-box team-a active" onclick="switchTeam('A')">
                    <div class="text-[10px] text-blue-300 mb-1 font-['Press_Start_2P']">TEAM A</div>
                    <div class="text-xs text-blue-300 mb-1"><i class="fas fa-user-astronaut"></i></div>
                    <div id="score-a" class="text-xl font-bold text-white mb-1 font-['Press_Start_2P']">0</div>
                    <div class="flex justify-center gap-1" onclick="event.stopPropagation()">
                        <button onclick="adjustScore('A', -1)" class="score-btn bg-red-500 text-white hover:bg-red-600">-</button>
                        <button onclick="adjustScore('A', 1)" class="score-btn bg-green-500 text-white hover:bg-green-600">+</button>
                    </div>
                </div>
                <div id="box-b" class="team-box team-b" onclick="switchTeam('B')">
                    <div class="text-[10px] text-pink-300 mb-1 font-['Press_Start_2P']">TEAM B</div>
                    <div class="text-xs text-pink-300 mb-1"><i class="fas fa-user-ninja"></i></div>
                    <div id="score-b" class="text-xl font-bold text-white mb-1 font-['Press_Start_2P']">0</div>
                    <div class="flex justify-center gap-1" onclick="event.stopPropagation()">
                        <button onclick="adjustScore('B', -1)" class="score-btn bg-red-500 text-white hover:bg-red-600">-</button>
                        <button onclick="adjustScore('B', 1)" class="score-btn bg-green-500 text-white hover:bg-green-600">+</button>
                    </div>
                </div>
            </div>
            <div class="text-center mt-2">
                <span class="text-xs bg-gray-800 px-3 py-1 rounded-full text-gray-300 border border-gray-600" id="turn-indicator">
                    Moving: TEAM A
                </span>
            </div>
        </div>

        <!-- Controls -->
        <div class="bg-gray-700 p-3 rounded-lg">
            <h3 class="text-xs font-bold text-gray-300 uppercase mb-2">Destination</h3>
            <select id="target-select" class="w-full bg-gray-200 text-gray-800 p-2 rounded text-sm font-bold border-2 border-gray-400 mb-3 cursor-pointer">
                <optgroup label="Left Side">
                    <option value="factory">Factory</option>
                    <option value="station">Station</option>
                    <option value="taxi">Taxi Rank</option>
                </optgroup>
                <optgroup label="Top Block">
                    <option value="library">Library</option>
                    <option value="cafe">Cafe</option>
                    <option value="main_square">Main Square</option>
                    <option value="government_building">Gov. Building</option>
                    <option value="post_office">Post Office</option>
                    <option value="hotel">Hotel</option>
                    <option value="theatre">Theatre</option>
                </optgroup>
                <optgroup label="Middle Left Block">
                    <option value="department_store">Department Store</option>
                    <option value="supermarket">Supermarket</option>
                    <option value="cinema">Cinema</option>
                    <option value="car_park">Car Park</option>
                    <option value="bank">Bank</option>
                    <option value="book_shop">Book Shop</option>
                </optgroup>
                <optgroup label="Middle Right Block">
                    <option value="shopping_centre">Shopping Centre</option>
                    <option value="shoe_shop">Shoe Shop</option>
                    <option value="chemist">Chemist</option>
                </optgroup>
                <optgroup label="Bottom Area">
                    <option value="central_park">Central Park</option>
                    <option value="museum">Museum</option>
                    <option value="stadium">Stadium</option>
                </optgroup>
                <optgroup label="Right Strip">
                    <option value="green_park">Green Park</option>
                    <option value="swimming_pool">Swimming Pool</option>
                    <option value="sports_centre">Sports Centre</option>
                    <option value="bus_stop">Bus Stop</option>
                </optgroup>
            </select>
            
            <button onclick="checkLocation()" class="big-btn bg-red-600 text-white border-red-800 hover:bg-red-500 mb-3">
                I AM HERE!
            </button>
            
            <div class="grid grid-cols-2 gap-2">
                <button onclick="resetPosition()" class="bg-blue-600 text-white text-xs font-bold py-2 rounded hover:bg-blue-500 transition">
                    <i class="fas fa-undo mr-1"></i> Reset Pos
                </button>
                <button onclick="toggleBlindMode()" id="blind-btn" class="bg-gray-600 text-white text-xs font-bold py-2 rounded hover:bg-gray-500 transition">
                    üëÅÔ∏è Hide Labels
                </button>
            </div>
            
            <div class="mt-3 text-center">
                 <button onclick="toggleDebug()" id="debug-btn" class="text-[10px] text-gray-500 hover:text-white underline uppercase tracking-widest">Toggle Debug Hitboxes</button>
            </div>
        </div>
        
        <div class="mt-auto text-center text-gray-500 text-[10px] p-2">
            Use Arrow Keys to Move
        </div>
    </div>

    <!-- Map Area -->
    <div id="main-area">
        <div id="game-container">
            
            <!-- --- ROADS --- -->
            <!-- Station Road (Vertical) -->
            <div class="road-label road-v" style="top: 50%; left: 21.5%;">Station Road</div>
            <!-- Park Avenue (Vertical) -->
            <div class="road-label road-v" style="top: 50%; left: 54.5%;">Park Avenue</div>
            <!-- East Street (Vertical) -->
            <div class="road-label road-v" style="top: 50%; left: 81.5%;">East Street</div>
            <!-- Central Street (Horizontal) -->
            <div class="road-label" style="top: 32%; left: 62%;">Central Street</div>
            <!-- Second Street (Horizontal) -->
            <div class="road-label" style="top: 61%; left: 38%;">Second Street</div>

            <!-- --- LEFT SIDE (0 - 20%) --- -->
            <!-- Factory -->
            <div class="building bg-white-trans" style="top: 25%; left: 2%; width: 8%; height: 26%;" title="factory">
                <i class="fas fa-industry text-yellow-700"></i><br>FACTORY
            </div>
            <!-- Station -->
            <div class="building bg-white-trans" style="top: 25%; left: 11%; width: 8%; height: 26%;" title="station">
                <i class="fas fa-train text-red-600"></i><br>STATION
            </div>
            <!-- Rails (Visual) -->
            <div style="position:absolute; top:0; left:15%; width:2%; height:100%; border-left:2px dashed #555; pointer-events:none;"></div>
            <!-- Taxi -->
            <div class="building bg-grey-build" style="top: 32%; left: 19.5%; width: 2.5%; height: 10%; font-size:0.6vw; padding:0; border:1px solid #999;" title="taxi">
                <span style="writing-mode: vertical-rl; text-orientation: mixed;">TAXI</span>
            </div>

            <!-- --- TOP ROW (Above Central St) --- -->
            <!-- Library/Cafe Block (23% - 53%) -->
            <div style="position: absolute; top: 2%; left: 23%; width: 29%; height: 28%; border: 1px solid #999; background: #d1d5db;">
                <!-- Library -->
                <div class="building bg-beige" style="top: 0; left: 0; width: 45%; height: 100%; border:none; border-right:1px solid #ccc;" title="library">
                    LIBRARY<br><i class="fas fa-book text-red-700 mt-2"></i>
                </div>
                <!-- Cafe -->
                <div class="building bg-beige" style="top: 0; left: 45%; width: 55%; height: 35%; border:none; border-bottom:1px solid #ccc;" title="cafe">
                    CAF√â <i class="fas fa-coffee text-purple-700 ml-1"></i>
                </div>
                <!-- Main Square (Open space) -->
                <div style="position:absolute; bottom:20%; right:15%; color:#333; font-weight:bold; font-size:0.8vw;" title="main_square">MAIN SQUARE</div>
            </div>

            <!-- Gov Building -->
            <div class="building bg-beige" style="top: 2%; left: 53%; width: 11%; height: 28%;" title="government_building">
                <i class="fas fa-landmark text-red-800 mb-1"></i>GOVERNMENT<br>BUILDING
            </div>
            <!-- Post Office -->
            <div class="building bg-beige" style="top: 2%; left: 64%; width: 10%; height: 28%;" title="post_office">
                POST<br>OFFICE<br><i class="fas fa-envelope text-blue-700 mt-1"></i>
            </div>
            <!-- Hotel -->
            <div class="building bg-beige" style="top: 2%; left: 74%; width: 8%; height: 28%;" title="hotel">
                <span class="bg-yellow-200 px-1 border border-black text-[0.6vw] mb-1">HOTEL</span>
                <i class="fas fa-hotel text-blue-400"></i>
            </div>
            <!-- Theatre -->
            <div class="building bg-beige" style="top: 2%; left: 82%; width: 11%; height: 28%;" title="theatre">
                THEATRE<br><i class="fas fa-masks-theater text-yellow-600 mt-2"></i>
            </div>

            <!-- --- MIDDLE LEFT BLOCK (Adjusted to add Entrance between Cinema/Bank) --- -->
            
            <!-- Department Store (Top Left) - Touches Car Park & Supermarket -->
            <div class="building bg-beige" style="top: 38%; left: 23%; width: 13%; height: 11%; border-right:1px solid #999; border-bottom:1px solid #999;" title="department_store">
                DEPARTMENT<br>STORE
            </div>
            
            <!-- Cinema (Bottom Left) - Narrower to create gap -->
            <div class="building bg-beige" style="top: 49%; left: 23%; width: 11%; height: 9%; border-right:1px solid #999;" title="cinema">
                CINEMA
            </div>

            <!-- Supermarket (Top Right) -->
            <div class="building bg-beige" style="top: 38%; left: 36%; width: 16%; height: 5%; border-bottom:1px solid #999;" title="supermarket">
                SUPERMARKET
            </div>
            
            <!-- Car Park (Middle Right) -->
            <div class="building bg-grey-build" style="top: 43%; left: 36%; width: 16%; height: 8%; border-bottom:1px solid #999;" title="car_park">
                CAR PARK
            </div>
            
            <!-- Bank (Bottom Right - Left side) -->
            <div class="building bg-beige" style="top: 51%; left: 36%; width: 8%; height: 7%; border-right:1px solid #999;" title="bank">
                BANK
            </div>
            
            <!-- Book Shop (Bottom Right - Right side) -->
            <div class="building bg-beige" style="top: 51%; left: 44%; width: 8%; height: 7%;" title="book_shop">
                BOOK<br>SHOP
            </div>

            <!-- Walkway Icon in the gap -->
            <div style="position: absolute; top: 52%; left: 34.2%; width: 1.8%; height: 6%; z-index:5; display:flex; justify-content:center; align-items:center;">
                <i class="fas fa-person-walking text-gray-500 text-[0.8vw]"></i>
            </div>

            <!-- --- MIDDLE RIGHT BLOCK (56.5% - 79%) --- -->
            <!-- Shopping Centre Complex -->
            <div style="position: absolute; top: 38%; left: 56.5%; width: 23.5%; height: 20%; border: 1px solid #555; background: #fef3c7;">
                <!-- Shoe Shop -->
                <div class="building bg-beige" style="top: 0; left: 40%; width: 30%; height: 25%; border:1px solid #999;" title="shoe_shop">
                    <span class="label-xs">SHOE<br>SHOP</span>
                </div>
                <!-- Chemist -->
                <div class="building bg-beige" style="top: 0; left: 70%; width: 30%; height: 25%; border:1px solid #999;" title="chemist">
                    <span class="label-xs">CHEMIST</span>
                </div>
                <!-- Shopping Centre Text Area -->
                <div class="building bg-beige" style="top: 25%; left: 25%; width: 50%; height: 75%; border:none; display:flex; justify-content:center; align-items:center;" title="shopping_centre">
                    SHOPPING<br>CENTRE<br><i class="fas fa-cart-shopping text-blue-800 mt-1"></i>
                </div>
                <!-- Empty Grid Cells (Visual only, part of SC complex) -->
                <div style="position:absolute; top:0; left:0; width:25%; height:50%; border:1px solid #999;"></div>
                <div style="position:absolute; top:50%; left:0; width:25%; height:50%; border:1px solid #999;"></div>
                <div style="position:absolute; top:0; left:25%; width:15%; height:25%; border:1px solid #999;"></div>
                <div style="position:absolute; top:25%; left:70%; width:30%; height:37.5%; border:1px solid #999;"></div>
                <div style="position:absolute; top:62.5%; left:70%; width:30%; height:37.5%; border:1px solid #999;"></div>
            </div>

            <!-- --- BOTTOM LEFT BLOCK (23% - 53%) --- -->
            <div style="position: absolute; top: 65%; left: 23%; width: 29%; height: 32%; background: #bef264; border: 1px solid #555;" title="central_park">
                <div style="width:100%; text-align:center; padding-top:10px; color:#1e293b; font-weight:800; font-size:0.9vw;">CENTRAL PARK</div>
                <!-- Trees -->
                <i class="fas fa-tree text-green-800 absolute top-[10%] left-[10%] text-[1.5vw]"></i>
                <i class="fas fa-tree text-green-800 absolute top-[10%] right-[10%] text-[1.5vw]"></i>
                <i class="fas fa-tree text-green-800 absolute bottom-[10%] left-[10%] text-[1.5vw]"></i>
                <i class="fas fa-tree text-green-800 absolute bottom-[10%] right-[10%] text-[1.5vw]"></i>
                
                <!-- Museum -->
                <div class="building bg-beige" style="top: 40%; left: 25%; width: 50%; height: 20%; border:1px solid #999;" title="museum">
                    MUSEUM
                </div>
            </div>

            <!-- --- BOTTOM MIDDLE BLOCK (56.5% - 79%) --- -->
            <div style="position: absolute; top: 65%; left: 56.5%; width: 23.5%; height: 32%; background: white; border: 1px solid #555; display:flex; justify-content:center; align-items:center;">
                <!-- Stadium Oval -->
                <div class="building bg-green-park" style="position:relative; width: 60%; height: 80%; border-radius: 50%; border: 3px solid #15803d; display:flex; justify-content:center; align-items:center;" title="stadium">
                    STADIUM
                </div>
            </div>

            <!-- --- RIGHT STRIP (83% - 98%) --- -->
            <!-- Green Park -->
            <div class="building bg-green-park" style="top: 38%; left: 83%; width: 15%; height: 28%;" title="green_park">
                GREEN<br>PARK<br>
                <div style="display:flex; gap:5px; margin-top:5px;">
                    <i class="fas fa-tree text-green-800"></i>
                    <i class="fas fa-tree text-green-800"></i>
                </div>
            </div>
            <!-- Pool/Sports/Bus Box -->
            <div style="position: absolute; top: 67%; left: 83%; width: 15%; height: 30%; border: 1px solid #555; background: #fef3c7;">
                <!-- Pool -->
                <div class="building bg-blue-pool" style="top: 5%; left: 5%; width: 90%; height: 25%; border:1px solid #3b82f6;" title="swimming_pool">
                    SWIMMING<br>POOL
                </div>
                <!-- Sports Centre -->
                <div class="building" style="top: 35%; left: 0; width: 100%; height: 45%; background:transparent; border:none; box-shadow:none;" title="sports_centre">
                    <i class="fas fa-basketball text-orange-700"></i><br>SPORTS<br>CENTRE
                </div>
                <!-- Bus Stop -->
                <div class="building bg-grey-build" style="bottom: 0; left: 0; width: 100%; height: 15%; border:none; border-top:1px solid #999;" title="bus_stop">
                    <span class="label-xs">BUS STOP</span>
                </div>
            </div>

            <!-- --- START MARKER --- -->
            <div style="position:absolute; top:90%; left:53%; font-size:3vw; color:red; font-weight:bold; pointer-events:none;">X</div>

            <!-- Players -->
            <div id="player-a" class="player-token"><i class="fas fa-user-astronaut"></i></div>
            <div id="player-b" class="player-token inactive"><i class="fas fa-user-ninja"></i></div>

            <!-- Overlays -->
            <div id="monster-screen" class="overlay-screen">
                <div class="text-9xl text-red-500 mb-4 animate-bounce"><i class="fas fa-skull-crossbones"></i></div>
                <h2 class="text-3xl font-bold text-red-500 font-['Press_Start_2P'] mb-4 text-center leading-relaxed">GAME OVER</h2>
                <p class="text-xl text-gray-300 mb-8 text-center px-4">Oh no! You have been kidnapped and taken to Cambodia!</p>
                <button onclick="closeOverlay()" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-full hover:bg-gray-500">Close</button>
            </div>

            <div id="win-screen" class="overlay-screen">
                <div class="text-9xl text-yellow-300 mb-4 animate-pulse"><i class="fas fa-star"></i></div>
                <h2 class="text-4xl font-bold text-white font-['Press_Start_2P'] mb-4">CORRECT!</h2>
                <button onclick="closeOverlay()" class="bg-green-600 text-white font-bold py-3 px-8 rounded-full hover:bg-green-500 shadow-lg">Continue</button>
            </div>
        </div>
    </div>

    <script>
        // --- HITBOX DATA (Pixels Perfect Percentages) ---
        const locations = {
            "factory": { t: 25, l: 2, w: 8, h: 26 },
            "station": { t: 25, l: 11, w: 8, h: 26 },
            "taxi": { t: 32, l: 19.5, w: 2.5, h: 10 },
            
            "library": { t: 2, l: 23, w: 14, h: 28 }, // Whole left part of top block
            "cafe": { t: 2, l: 37, w: 15, h: 10 }, // Top right of that block
            "main_square": { t: 12, l: 37, w: 15, h: 18 }, // Bottom right of that block
            
            "government_building": { t: 2, l: 53, w: 11, h: 28 },
            "post_office": { t: 2, l: 64, w: 10, h: 28 },
            "hotel": { t: 2, l: 74, w: 8, h: 28 },
            "theatre": { t: 2, l: 82, w: 11, h: 28 },
            
            "department_store": { t: 38, l: 23, w: 13, h: 11 }, // Extended width to touch right block
            "cinema": { t: 49, l: 23, w: 11, h: 9 }, // Narrower to create gap
            "supermarket": { t: 38, l: 36, w: 16, h: 5 },
            "car_park": { t: 43, l: 36, w: 16, h: 8 },
            "bank": { t: 51, l: 36, w: 8, h: 7 }, // Starts at 36, so there's a gap from cinema end (34)
            "book_shop": { t: 51, l: 44, w: 8, h: 7 },
            
            "shopping_centre": { t: 38, l: 56.5, w: 23.5, h: 20 }, // Cover whole block as SC usually
            "shoe_shop": { t: 38, l: 65, w: 8, h: 5 }, // Specific hitboxes inside
            "chemist": { t: 38, l: 73, w: 7, h: 5 },
            
            "central_park": { t: 65, l: 23, w: 29, h: 32 },
            "museum": { t: 75, l: 30, w: 15, h: 8 },
            "stadium": { t: 65, l: 56.5, w: 23.5, h: 32 },
            
            "green_park": { t: 38, l: 83, w: 15, h: 28 },
            "swimming_pool": { t: 68, l: 84, w: 13, h: 8 },
            "sports_centre": { t: 76, l: 83, w: 15, h: 15 },
            "bus_stop": { t: 92, l: 83, w: 15, h: 5 }
        };

        let teamA = { x: 50, y: 90, el: document.getElementById('player-a') };
        let teamB = { x: 55, y: 90, el: document.getElementById('player-b') };
        let currentTurn = 'A';
        const speed = 0.5;
        let keysPressed = {};
        let scores = { A: 0, B: 0 };
        let debugMode = false;
        let blindMode = false;

        function switchTeam(team) {
            currentTurn = team;
            updateUIState();
        }

        function updateUIState() {
            const boxA = document.getElementById('box-a');
            const boxB = document.getElementById('box-b');
            const indicator = document.getElementById('turn-indicator');
            const playerAEl = teamA.el;
            const playerBEl = teamB.el;

            if (currentTurn === 'A') {
                boxA.classList.add('active'); boxB.classList.remove('active');
                indicator.innerText = "Moving: TEAM A";
                indicator.className = "text-xs bg-blue-900 px-3 py-1 rounded-full text-blue-200 border border-blue-700";
                playerAEl.classList.remove('inactive'); playerBEl.classList.add('inactive');
                playerAEl.style.zIndex = 60; playerBEl.style.zIndex = 40;
            } else {
                boxA.classList.remove('active'); boxB.classList.add('active');
                indicator.innerText = "Moving: TEAM B";
                indicator.className = "text-xs bg-pink-900 px-3 py-1 rounded-full text-pink-200 border border-pink-700";
                playerBEl.classList.remove('inactive'); playerAEl.classList.add('inactive');
                playerBEl.style.zIndex = 60; playerAEl.style.zIndex = 40;
            }
        }

        function adjustScore(team, amount) {
            scores[team] += amount;
            if (scores[team] < 0) scores[team] = 0; 
            document.getElementById(`score-${team.toLowerCase()}`).innerText = scores[team];
        }

        function closeOverlay() {
            document.getElementById('monster-screen').classList.remove('active');
            document.getElementById('win-screen').classList.remove('active');
        }

        function resetScores() {
            scores.A = 0; scores.B = 0; 
            document.getElementById('score-a').innerText = 0;
            document.getElementById('score-b').innerText = 0;
            resetPosition();
            currentTurn = 'A';
            updateUIState();
        }

        function resetPosition() {
            teamA.x = 50; teamA.y = 90;
            teamB.x = 55; teamB.y = 90;
            updatePlayerVisuals();
        }

        function updatePlayerVisuals() {
            teamA.el.style.left = teamA.x + "%";
            teamA.el.style.top = teamA.y + "%";
            teamB.el.style.left = teamB.x + "%";
            teamB.el.style.top = teamB.y + "%";
        }

        function gameLoop() {
            let activeTeam = currentTurn === 'A' ? teamA : teamB;
            let moved = false;
            
            if (keysPressed['ArrowUp']) { activeTeam.y -= speed; moved = true; }
            if (keysPressed['ArrowDown']) { activeTeam.y += speed; moved = true; }
            if (keysPressed['ArrowLeft']) { activeTeam.x -= speed; moved = true; }
            if (keysPressed['ArrowRight']) { activeTeam.x += speed; moved = true; }

            if (moved) {
                if (activeTeam.x < 0) activeTeam.x = 0; if (activeTeam.x > 95) activeTeam.x = 95;
                if (activeTeam.y < 0) activeTeam.y = 0; if (activeTeam.y > 95) activeTeam.y = 95;
                activeTeam.el.style.left = activeTeam.x + "%";
                activeTeam.el.style.top = activeTeam.y + "%";
            }
            requestAnimationFrame(gameLoop);
        }

        function checkLocation() {
            const targetName = document.getElementById('target-select').value;
            const zone = locations[targetName];
            if(!zone) return;

            let activeTeam = currentTurn === 'A' ? teamA : teamB;
            // Player center point (width is 5%, so center is +2.5)
            const pX = activeTeam.x + 2.5; 
            const pY = activeTeam.y + 2.5; 

            // FORGIVING BUFFER: 5% around the building
            const buffer = 5.0; 

            const inX = pX >= (zone.l - buffer) && pX <= (zone.l + zone.w + buffer);
            const inY = pY >= (zone.t - buffer) && pY <= (zone.t + zone.h + buffer);

            if (inX && inY) {
                document.getElementById('win-screen').classList.add('active');
            } else {
                document.getElementById('monster-screen').classList.add('active');
            }
        }

        function toggleDebug() {
            debugMode = !debugMode;
            document.querySelectorAll('.building').forEach(el => el.classList.remove('highlight-debug'));
            if (debugMode) {
                const targetName = document.getElementById('target-select').value;
                const el = document.querySelector(`.building[title="${targetName}"]`);
                if(el) el.classList.add('highlight-debug');
            }
            const btn = document.getElementById('debug-btn');
            btn.innerText = debugMode ? "DEBUG HITBOXES: ON" : "TOGGLE DEBUG HITBOXES";
            btn.style.color = debugMode ? "#ef4444" : "#6b7280";
        }

        function toggleBlindMode() {
            blindMode = !blindMode;
            const container = document.getElementById('game-container');
            const btn = document.getElementById('blind-btn');
            if (blindMode) {
                container.classList.add('blind-mode');
                btn.innerHTML = 'üëÅÔ∏è Show Labels';
                btn.classList.add('bg-purple-600');
            } else {
                container.classList.remove('blind-mode');
                btn.innerHTML = 'üëÅÔ∏è Hide Labels';
                btn.classList.remove('bg-purple-600');
            }
        }

        document.addEventListener('keydown', (e) => {
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault(); keysPressed[e.key] = true;
            }
            if (e.key === 'Enter') checkLocation();
        });
        document.addEventListener('keyup', (e) => {
            if (keysPressed[e.key]) delete keysPressed[e.key];
        });
        
        document.getElementById('target-select').addEventListener('change', (e) => {
            if(debugMode) {
                document.querySelectorAll('.highlight-debug').forEach(el => el.classList.remove('highlight-debug'));
                const el = document.querySelector(`.building[title="${e.target.value}"]`);
                if(el) el.classList.add('highlight-debug');
            }
        });

        updatePlayerVisuals();
        updateUIState();
        requestAnimationFrame(gameLoop);

    </script>
</body>
</html>
